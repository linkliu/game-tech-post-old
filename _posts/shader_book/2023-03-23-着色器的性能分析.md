---
category: shader
tags: [U3D, Shader,Cookbook,中文版]
---

## 着色器的性能分析   
我们现在知道该如何减少色器可能出现的内存消耗，让我们来了解一下在场景中，如何在大量同时运行的游戏对象，着色器和脚本等包含的大量着色器中，找出有问题的着色器。要在整个游戏中去找到某一个单独的游戏对象或者着色器可能会让人有点望而却步，但是Unity给我们提供了它内建的性能分析工具。它可以让我们知道在游戏中每一帧都发生了什么，CPU和GPU资源使用情况。   
<br>
通过使用性能分析工具，我们可以使用其界面创建分析作业块，来单独分析诸如着色器、几何图新和一些一般渲染项。我们可以筛选出我们要寻找的影响性能的单个游戏对象。这让我们能够在运行时观察对象执行其功能时对 CPU和GPU的影响。   
<br>
让我们来看看性能分析工具的不同部分和并且学习如何调试我们的场景，当然更重要的是如何调试我们的着色器。   

*** 
<br>
- **始前准备**   
  为了使用性能分析器，我们要准备好一些资源并且打开我们的性能分析窗口：   
  - 1.我们就使用介绍上一个知识点时的场景，然后通过菜单 **Window &#124; Profiler** 或 ***Ctrl + 7*** 打开性能分析窗口。
  - 2.我们多复制几个球体，看看这样会对渲染有什么影响。   
  你会看到跟下图类似的一些东西：   
  ![diagram](https://linkliu.github.io/game-tech-post/assets/img/shader_book/diagram76.png){:  .shadow width = "90%" }   


  ***
  <br>


- **操作步骤**   
  使用性能分析工具的时候，你会在该窗口看到一些UI元素。在我们点击运行按钮前，让我们了解一下该如何从性能分析器中获取我们想要的信息：   
  - 1.首先，点击 **Profiler** 窗口中的 **GPU Usage**，**CPU Usage** 和 **Rendering**这几栏。你可以在窗口的左上角找到这几栏：   
  ![diagram](https://linkliu.github.io/game-tech-post/assets/img/shader_book/diagram77.png){:  .shadow width = "90%" }   
  使用这几栏，我们可以看到跟游戏主要功能相关的不同的数据。**CPU Usage** 给我们展示的是我们大部分脚本在干什么，当然还有物理运算和总体渲染。**GPU Usage** 这一栏给我们的是光照，阴影和渲染队列等的详情信息。最后，**Rendering** 这一栏有每一帧中 **drawcall** 和游戏场景中集合体的数量这些信息。   
  <br>
  点击其中的一栏，我们就可以把在 **性能会话（profiling session）** 中看到的数据类型单独分离出来分析。   