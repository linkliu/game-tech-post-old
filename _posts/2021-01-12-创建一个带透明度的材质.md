---
category: shader
tags: [U3D, Shader,Cookbook,中文版]
---

## 创建一个带透明度的材质

到目前为止我们所看到的着色器似乎都有一个共同点——它们都用于了固体材质。如果你想要的提升你的游戏的视觉效果，那么带透明度的材质通常是一个好的开始。它们用途广泛，从火焰效果到窗户的玻璃都会用到它们。但稍微麻烦的是，它们用起来要复杂一点点。在渲染固体模型之前，Unity会根据它们离摄像机的距离(**这个叫Z ordering**)进行排序，并且跳过渲染所有背朝摄像机的三角面(**这个是剔除技术culling**)。当渲染带透明度的几何物体时，这些含有两个面的几何物体就会产生问题。这次的知识点将会为你展示：当我们创建有透明度的表面着色器时，我们如何解决这个过程中产生的这些问题。我们在**[第六章](),片元着色器和通道提取**我们还会着重回顾这个话题，真实渲染中的玻璃和水体着色器都会涉及到。

***




- **始前准备**

  这个知识点需要一个新的着色器，我们就叫它**Transparent**吧。同时也需要一个新的材质，这样才能把着色器应用于游戏物体。因为这个物体需要成为一个透明的玻璃窗，那么我们最好用Unity中的**quad**或者**plane**来做。我们当然也需要一些不透明的其他游戏对象来对比测试效果。在这个例子中，我们会使用一张PNG图片作为玻璃纹理。这张图片的alpha通道将会用于控制玻璃的透明度。这样的PNG图片大家自行自作，软件不限。但是需要遵守下面的这些步骤：

  1. 找一张要用于你窗户玻璃的图片。

  2. 用照片编辑软件打开这样图片，比如**GIMP**或者**Photoshop**。

  3. 选择图片中你想要变成半透明的部分。

  4. 在这张图片上创建一个空白(**full opacity**[抱歉我不懂PS，不知道这个参数的含义])图层

  5. 选择上一步创建的图片，以黑色来填充这个图层。

  6. 保存图片然后导入到Unity中。

  这个知识点中，我们用来试验的图片是一张来自**圣斯德望主教座堂** ***Meaux Cathedral in France([https://en.wikipedia.org/wiki/Stained_glass](https://en.wikipedia.org/wiki/Stained_glass  ))***的花窗玻璃。
  
  如果遵循了上面的图片制作步骤，那么你也会获得如下类似的一张图片（**RGB**通道在左图，**A**通道在右图）：
  
  <div align="center"><img src="https://linkliu.github.io/game-tech-post/assets/img/shader_book/diagram21.png"/></div>

***




- **操作步骤**

  正如我们前面提醒的，我们在使用透明度着色器时需要注意几个方面：

  1. 在着色器的**SubShader{}**代码块中，添加下面的**标签**告知着色器这是用于透明度的：

     ```
     Tags
     {
     	"Queue" = "Transparent"
     	"IgnoreProjector" = "True"
     	"RenderType" = "Transparent"
     }
     ```

     

  2. 由于这个着色器是为2D 材料设计的，所以确保你的模型的背面不会被绘制，通过添加下面的这个代码：

     ```
     Cull Back
     ```

  3. 告诉着色器这个材料是半透明的并且需要跟屏幕中绘制的什么内容混合：

     ```
     #pragma surface surf Standard alpha:fade
     ```

  4. 使用这个表面着色器来决定玻璃的颜色和透明度：

     ```
     void surf(Input IN, inout SurfaceOutputStandard o)
     {
     	float4 c = tex2D(_MainTex, IN.uv_MainTex) * _Color;
     	o.Albedo = c.rgb;
     	o.Alpha = c.a;
     }
     ```

     