---
category: shader
tags: [U3D, Shader,Cookbook,中文版]
---

## 法线映射

3D模型的每一个三角面都有一个**朝向facing direction**，这个朝向就是它向前的指向。它通常用一个垂直并且放置在三角面正中心的一个箭头来表示。这个朝向对于光在表面反射中来说非常的重要。如果相邻的两个三角面朝向不同的方向，那么它们对光的反射也会朝向不同的角度，也就是在着色器中它们的处理方式会不一样。对于曲面物体来说，这里有个疑问：很显然这些拥有曲面的几何体仍然是由平面三角形构成的，那光线改如何处理？

为了避免这个问题，对应三角面的光的反射计算方式此时不根据它的朝向计算，而是根据它的**法线方向normal direction**方向计算。前面***向着色器添加贴图***那个知识点讲到，顶点是保存有数据的。法线方向信息也是继UV信息之后，保存在顶点中最有用的信息。这是一个单位长度的向量，并且它表示了顶点的朝向。不考虑朝向的话，那么三角面内的每一个顶点都有它自己的法线方向，只不过这个法线方向是一个存储在顶点中的线性插值。这给了我们用低模模拟高模的能力。下面示例图展示了同一个几何形状在不同的顶点插值密度下的表现。在左边，法线垂直于由顶点表示的面；很明显每个面之间有明显的的割裂感。再看看最右边的几何体，它的法线是通过他的面线性插值得到的，可以看出来的是，尽管它的表面看起来还是很粗糙，但是光线的反射看起来却似乎很光滑。很容易看出来尽管这三个物体的几何体都相同，但是它们的光线反射却不一样。尽管都是由平面三角形构成，但是右边物体的光线反射似乎看起来像曲面反射。

<div align="center"><img src="https://linkliu.github.io/game-tech-post/assets/img/shader_book/diagram16.jpg"/></div> 

一个有着粗糙的边的光滑物体很明显的表示单位顶点的法线肯定进行了线性插值。如果我们对保存在每个顶点的法线按其方向进行绘制，我们就能够看到它们，正如下图所展示的那样。你应该注意的是每个三角形仅有三条法线，但是相连的三角形有相同的顶点，会看到不止有一条法线从中绘制出来。
<div align="center"><img src="https://linkliu.github.io/game-tech-post/assets/img/shader_book/diagram17.jpg"/></div> 

法线贴图在计算3D模型的法线技术中越来越流行。